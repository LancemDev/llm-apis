<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="../static/index.css">
</head>
<body>
    <div id="loading" class="spinner"></div>
    <div id="map" style="height: 1000px;"></div>
    
    <script>
        var map;
        var marker;
        var loading = document.getElementById('loading');
        var trail = [];  // Array to store the trail points

        function getLocation() {
            // Show the loading spinner
            loading.style.display = 'block';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    console.log(pos);

                    // Initialize the map if it's not already initialized
                    if (!map) {
                        map = L.map('map').setView([pos.lat, pos.lng], 13);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            maxZoom: 19,
                        }).addTo(map);
                    } else {
                        // Update the map center without changing the zoom level
                        map.panTo([pos.lat, pos.lng]);
                    }

                    // Remove the old marker if it exists
                    if (marker) {
                        map.removeLayer(marker);
                    }

                    // Add a new marker at the current location
                    marker = L.marker([pos.lat, pos.lng]).addTo(map);

                    // Add the current location to the trail
                    trail.push([pos.lat, pos.lng]);

                    // Draw the trail on the map
                    L.polyline(trail, {color: 'red'}).addTo(map);
                });
            }
        }

        // Call getLocation immediately
        getLocation();

        // Then call getLocation every 5 seconds
        setInterval(getLocation, 5000);
    </script>

</body>
</html>